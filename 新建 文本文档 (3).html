<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微软 TTS 免费部署</title>
</head>
<body>
    <h1>微软 TTS 示例</h1>
    <textarea id="text-input" rows="4" cols="50">请输入文本...</textarea><br><br>
    <button onclick="speakText()">播放语音</button>

    <script>
        const subscriptionKey = "EnAqcnMkoVc5O2yW9IosQN4pJ6JC526EBtcgrafmAXNlX80RE69iJQQJ99BAACYeBjFXJ3w3AAAYACOG3Pfr";
        const region = "eastus";
        
        async function speakText() {
            const text = document.getElementById("text-input").value;
            const endpoint = `https://${region}.tts.speech.microsoft.com/cognitiveservices/v1`;

            const ssml = `
                <speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <voice name="zh-CN-XiaoxiaoNeural">
                        ${text}
                    </voice>
                </speak>
            `;

            const headers = {
                "Content-Type": "application/ssml+xml",
                "X-Microsoft-OutputFormat": "audio-16khz-32kbitrate-mono-mp3",
                "Authorization": `Bearer ${await getAuthToken()}`
            };

            const response = await fetch(endpoint, {
                method: "POST",
                headers: headers,
                body: ssml
            });

            if (response.ok) {
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                audio.play();
            } else {
                console.error("请求失败:", response.status, await response.text());
            }
        }

        async function getAuthToken() {
            const tokenEndpoint = `https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token`;
            const params = new URLSearchParams();
            params.append("grant_type", "client_credentials");
            params.append("client_id", "YOUR_CLIENT_ID");
            params.append("client_secret", "YOUR_CLIENT_SECRET");
            params.append("scope", "https://speech.platform.bing.com/.default");

            const response = await fetch(tokenEndpoint, {
                method: "POST",
                body: params
            });

            const data = await response.json();
            return data.access_token;
        }
    </script>
</body>
</html>
